<!-- ============================================
     ì—…ë¬´ ì¼ì • ê´€ë¦¬ ì‹œìŠ¤í…œ - íšŒì‚¬/íŒ€ ê´€ë¦¬
     ìœ„ì¹˜: C:\Users\user\Desktop\ì¸ê³µì§€ëŠ¥ì‚°ì—…í˜‘íšŒAI\templates\company.html
     ============================================ -->
{% extends "base.html" %}

{% block title %}íšŒì‚¬/íŒ€ ê´€ë¦¬ - ì—…ë¬´ ì¼ì • ê´€ë¦¬{% endblock %}

{% block content %}
<div class="company-container">
    <div class="page-header">
        <h1>ğŸ¢ íšŒì‚¬/íŒ€ ê´€ë¦¬</h1>
        <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">â† ëŒ€ì‹œë³´ë“œ</a>
    </div>
    
    <div class="company-grid">
        <!-- ì™¼ìª½: í˜„ì¬ ì†Œì† ì •ë³´ -->
        <div class="company-info-section">
            <div class="info-card">
                <h2>ğŸ“ í˜„ì¬ ì†Œì†</h2>
                
                {% if company %}
                    <div class="info-item">
                        <label>ğŸ¢ íšŒì‚¬</label>
                        <div class="info-value">
                            {{ company.name }}
                            <span class="code-badge">{{ company.code }}</span>
                        </div>
                    </div>
                    
                    {% if current_user.team %}
                    <div class="info-item">
                        <label>ğŸ‘¥ íŒ€</label>
                        <div class="info-value">
                            {{ current_user.team.name }}
                            <span class="code-badge">{{ current_user.team.code }}</span>
                        </div>
                    </div>
                    <form method="POST" action="{{ url_for('leave_team') }}" class="mt-2">
                        <button type="submit" class="btn btn-danger btn-sm">íŒ€ íƒˆí‡´</button>
                    </form>
                    {% else %}
                    <div class="info-item">
                        <label>ğŸ‘¥ íŒ€</label>
                        <div class="info-value empty">ì†Œì† íŒ€ ì—†ìŒ</div>
                    </div>
                    {% endif %}
                    
                    <div class="info-item">
                        <label>ğŸ–ï¸ ê¶Œí•œ</label>
                        <div class="info-value">
                            {% if current_user.role == 'admin' %}
                                <span class="role-badge admin">ê´€ë¦¬ì</span>
                            {% elif current_user.role == 'team_leader' %}
                                <span class="role-badge leader">íŒ€ì¥</span>
                            {% else %}
                                <span class="role-badge member">ì¼ë°˜ ë©¤ë²„</span>
                            {% endif %}
                        </div>
                    </div>
                {% else %}
                    <div class="empty-state">
                        <p>ğŸ  ì•„ì§ íšŒì‚¬ì— ì†Œì†ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>
                        <p>íšŒì‚¬ë¥¼ ìƒì„±í•˜ê±°ë‚˜ ê¸°ì¡´ íšŒì‚¬ì— ê°€ì…í•˜ì„¸ìš”.</p>
                    </div>
                {% endif %}
            </div>
            
            <!-- íšŒì‚¬ ê°€ì…/ìƒì„± í¼ (íšŒì‚¬ ì—†ì„ ë•Œë§Œ) -->
            {% if not company %}
            <div class="action-card">
                <h3>ğŸ”‘ íšŒì‚¬ ì½”ë“œë¡œ ê°€ì…</h3>
                <form method="POST" action="{{ url_for('join_company') }}">
                    <div class="form-group">
                        <input type="text" name="company_code" placeholder="íšŒì‚¬ ì½”ë“œ ì…ë ¥ (ì˜ˆ: ABC12345)" 
                               required maxlength="20" style="text-transform: uppercase;">
                    </div>
                    <button type="submit" class="btn btn-primary btn-full">ê°€ì…í•˜ê¸°</button>
                </form>
            </div>
            
            <div class="action-card">
                <h3>ğŸ¢ ìƒˆ íšŒì‚¬ ìƒì„±</h3>
                <form method="POST" action="{{ url_for('create_company') }}">
                    <div class="form-group">
                        <input type="text" name="company_name" placeholder="íšŒì‚¬ëª…" required minlength="2">
                    </div>
                    <div class="form-group">
                        <input type="text" name="description" placeholder="íšŒì‚¬ ì„¤ëª… (ì„ íƒ)">
                    </div>
                    <button type="submit" class="btn btn-success btn-full">íšŒì‚¬ ìƒì„±</button>
                </form>
                <p class="hint">â€» íšŒì‚¬ ìƒì„± ì‹œ ê´€ë¦¬ì ê¶Œí•œì´ ë¶€ì—¬ë©ë‹ˆë‹¤.</p>
            </div>
            {% endif %}
            
            <!-- íŒ€ ê°€ì…/ìƒì„± í¼ (íšŒì‚¬ ìˆê³ , íŒ€ ì—†ì„ ë•Œ) -->
            {% if company and not current_user.team %}
            <div class="action-card">
                <h3>ğŸ”‘ íŒ€ ì½”ë“œë¡œ ê°€ì…</h3>
                <form method="POST" action="{{ url_for('join_team') }}">
                    <div class="form-group">
                        <input type="text" name="team_code" placeholder="íŒ€ ì½”ë“œ ì…ë ¥ (ì˜ˆ: DEV123)" 
                               required maxlength="20" style="text-transform: uppercase;">
                    </div>
                    <button type="submit" class="btn btn-primary btn-full">íŒ€ ê°€ì…</button>
                </form>
            </div>
            {% endif %}
            
            <!-- íŒ€ ìƒì„± (ê´€ë¦¬ì/íŒ€ì¥ë§Œ) -->
            {% if company and current_user.is_admin() %}
            <div class="action-card">
                <h3>ğŸ‘¥ ìƒˆ íŒ€ ìƒì„±</h3>
                <form method="POST" action="{{ url_for('create_team') }}">
                    <div class="form-group">
                        <input type="text" name="team_name" placeholder="íŒ€ëª…" required minlength="2">
                    </div>
                    <div class="form-group">
                        <input type="text" name="description" placeholder="íŒ€ ì„¤ëª… (ì„ íƒ)">
                    </div>
                    <button type="submit" class="btn btn-success btn-full">íŒ€ ìƒì„±</button>
                </form>
            </div>
            {% endif %}
        </div>
        
        <!-- ì˜¤ë¥¸ìª½: íŒ€ ëª©ë¡ & ë©¤ë²„ ëª©ë¡ -->
        <div class="company-lists-section">
            {% if company %}
            <!-- íŒ€ ëª©ë¡ -->
            <div class="list-card">
                <h2>ğŸ‘¥ íŒ€ ëª©ë¡ ({{ teams|length }}ê°œ)</h2>
                {% if teams %}
                <div class="team-list">
                    {% for team in teams %}
                    <div class="team-item">
                        <div class="team-info">
                            <strong>{{ team.name }}</strong>
                            <span class="code-badge small">{{ team.code }}</span>
                            {% if team.description %}
                            <p class="team-desc">{{ team.description }}</p>
                            {% endif %}
                        </div>
                        <div class="team-stats">
                            <span>ğŸ‘¤ {{ team.get_member_count() }}ëª…</span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="empty-list">ì•„ì§ ìƒì„±ëœ íŒ€ì´ ì—†ìŠµë‹ˆë‹¤.</div>
                {% endif %}
            </div>
            
            <!-- ë©¤ë²„ ëª©ë¡ -->
            <div class="list-card">
                <h2>ğŸ‘¤ ì „ì²´ ë©¤ë²„ ({{ members|length }}ëª…)</h2>
                {% if members %}
                <div class="member-list">
                    {% for member in members %}
                    <div class="member-item">
                        <div class="member-info">
                            <strong>{{ member.username }}</strong>
                            {% if member.role == 'admin' %}
                                <span class="role-badge admin small">ê´€ë¦¬ì</span>
                            {% elif member.role == 'team_leader' %}
                                <span class="role-badge leader small">íŒ€ì¥</span>
                            {% endif %}
                        </div>
                        <div class="member-team">
                            {% if member.team %}
                            {{ member.team.name }}
                            {% else %}
                            <span class="no-team">íŒ€ ë¯¸ë°°ì •</span>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="empty-list">ë©¤ë²„ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
                {% endif %}
            </div>
            
            <!-- ì´ˆëŒ€ ì•ˆë‚´ (ê´€ë¦¬ìë§Œ) -->
            {% if current_user.is_admin() %}
            <div class="invite-card">
                <h3>ğŸ“§ ì´ˆëŒ€ ì•ˆë‚´</h3>
                <p>ì•„ë˜ ì½”ë“œë¥¼ íŒ€ì›ë“¤ì—ê²Œ ê³µìœ í•˜ì„¸ìš”:</p>
                <div class="invite-codes">
                    <div class="invite-code">
                        <label>íšŒì‚¬ ì½”ë“œ:</label>
                        <code>{{ company.code }}</code>
                        <button class="btn-copy" onclick="copyCode('{{ company.code }}')">ë³µì‚¬</button>
                    </div>
                    {% for team in teams %}
                    <div class="invite-code">
                        <label>{{ team.name }} íŒ€:</label>
                        <code>{{ team.code }}</code>
                        <button class="btn-copy" onclick="copyCode('{{ team.code }}')">ë³µì‚¬</button>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
            {% endif %}
        </div>
    </div>
</div>

<style>
.company-container {
    max-width: 1200px;
    margin: 0 auto;
}

.page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
}

.company-grid {
    display: grid;
    grid-template-columns: 1fr 1.5fr;
    gap: 2rem;
}

.info-card, .action-card, .list-card, .invite-card {
    background: white;
    border-radius: 12px;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
    box-shadow: 0 2px 10px rgba(0,0,0,0.08);
}

.info-card h2, .list-card h2 {
    margin-top: 0;
    margin-bottom: 1.5rem;
    font-size: 1.2rem;
    border-bottom: 2px solid #e9ecef;
    padding-bottom: 0.75rem;
}

.action-card h3, .invite-card h3 {
    margin-top: 0;
    margin-bottom: 1rem;
    font-size: 1rem;
}

.info-item {
    margin-bottom: 1rem;
}

.info-item label {
    display: block;
    font-size: 0.85rem;
    color: #6c757d;
    margin-bottom: 0.25rem;
}

.info-value {
    font-size: 1.1rem;
    font-weight: 500;
}

.info-value.empty {
    color: #adb5bd;
    font-style: italic;
}

.code-badge {
    display: inline-block;
    background: #e9ecef;
    color: #495057;
    padding: 0.2rem 0.5rem;
    border-radius: 4px;
    font-size: 0.8rem;
    font-family: monospace;
    margin-left: 0.5rem;
}

.code-badge.small {
    font-size: 0.7rem;
    padding: 0.1rem 0.4rem;
}

.role-badge {
    display: inline-block;
    padding: 0.2rem 0.6rem;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 500;
}

.role-badge.admin {
    background: #ffc107;
    color: #212529;
}

.role-badge.leader {
    background: #17a2b8;
    color: white;
}

.role-badge.member {
    background: #e9ecef;
    color: #495057;
}

.role-badge.small {
    font-size: 0.65rem;
    padding: 0.1rem 0.4rem;
}

.hint {
    font-size: 0.8rem;
    color: #6c757d;
    margin-top: 0.5rem;
}

.team-list, .member-list {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.team-item, .member-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem;
    background: #f8f9fa;
    border-radius: 8px;
}

.team-desc {
    font-size: 0.8rem;
    color: #6c757d;
    margin: 0.25rem 0 0 0;
}

.team-stats, .member-team {
    font-size: 0.85rem;
    color: #6c757d;
}

.no-team {
    color: #adb5bd;
    font-style: italic;
}

.empty-list {
    text-align: center;
    color: #adb5bd;
    padding: 1rem;
}

.invite-codes {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.invite-code {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.invite-code label {
    min-width: 100px;
    font-size: 0.85rem;
}

.invite-code code {
    background: #212529;
    color: #00ff88;
    padding: 0.4rem 0.8rem;
    border-radius: 4px;
    font-size: 1rem;
    flex: 1;
}

.btn-copy {
    padding: 0.3rem 0.6rem;
    border: 1px solid #dee2e6;
    background: white;
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.8rem;
}

.btn-copy:hover {
    background: #f8f9fa;
}

.mt-2 {
    margin-top: 0.5rem;
}

.btn-danger {
    background: #dc3545;
    color: white;
    border: none;
}

.btn-danger:hover {
    background: #c82333;
}

.btn-sm {
    padding: 0.3rem 0.6rem;
    font-size: 0.8rem;
}

@media (max-width: 768px) {
    .company-grid {
        grid-template-columns: 1fr;
    }
}
</style>

<script>
function copyCode(code) {
    navigator.clipboard.writeText(code).then(function() {
        alert('ì½”ë“œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤: ' + code);
    }).catch(function() {
        prompt('ì½”ë“œë¥¼ ë³µì‚¬í•˜ì„¸ìš”:', code);
    });
}
</script>
{% endblock %}
