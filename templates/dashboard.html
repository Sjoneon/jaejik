<!-- ============================================
     ì—…ë¬´ ì¼ì • ê´€ë¦¬ ì‹œìŠ¤í…œ - ëŒ€ì‹œë³´ë“œ
     ìœ„ì¹˜: C:\Users\user\Desktop\ì¸ê³µì§€ëŠ¥ì‚°ì—…í˜‘íšŒAI\templates\dashboard.html
     ============================================ -->
{% extends "base.html" %}

{% block title %}ëŒ€ì‹œë³´ë“œ - ì—…ë¬´ ì¼ì • ê´€ë¦¬{% endblock %}

{% block content %}
<div class="dashboard">
    <!-- ìƒë‹¨ ì˜ì—­: ìº˜ë¦°ë” + ì¼ì • ëª©ë¡ -->
    <div class="dashboard-top">
        <!-- ì™¼ìª½: ìº˜ë¦°ë” -->
        <div class="calendar-section">
            <div class="section-header">
                <h2>ğŸ“† ìº˜ë¦°ë”</h2>
            </div>
            <div id="calendar"></div>
            <p class="calendar-hint">ğŸ’¡ ë‚ ì§œë¥¼ í´ë¦­í•˜ë©´ ìƒˆ ì¼ì •ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
        </div>
        
        <!-- ì˜¤ë¥¸ìª½: ì¼ì • ëª©ë¡ -->
        <div class="schedule-section">
            <div class="section-header">
                <h2>ğŸ“‹ ì¼ì •ë“¤ (ê¸‰í•œìˆœ)</h2>
            </div>
            <div class="schedule-list" id="schedule-list">
                {% if schedules %}
                    {% for schedule in schedules %}
                    <div class="schedule-item" 
                         data-id="{{ schedule.id }}"
                         style="border-left-color: {{ schedule.urgency_color }};">
                        <div class="schedule-urgency">
                            {% if schedule.days_left < 0 %}
                                <span class="urgency-badge overdue">ì§€ì—°</span>
                            {% elif schedule.days_left <= 2 %}
                                <span class="urgency-badge urgent">D-{{ schedule.days_left }}</span>
                            {% elif schedule.days_left <= 5 %}
                                <span class="urgency-badge soon">D-{{ schedule.days_left }}</span>
                            {% elif schedule.days_left <= 7 %}
                                <span class="urgency-badge warning">D-{{ schedule.days_left }}</span>
                            {% else %}
                                <span class="urgency-badge normal">D-{{ schedule.days_left }}</span>
                            {% endif %}
                        </div>
                        <div class="schedule-content">
                            <div class="schedule-title {% if schedule.is_completed %}completed{% endif %}">
                                {{ schedule.title }}
                            </div>
                            <div class="schedule-meta">
                                {% if schedule.document %}
                                    ğŸ“„ {{ schedule.document.filename }}
                                {% else %}
                                    âœï¸ ì§ì ‘ ì…ë ¥
                                {% endif %}
                                | {{ schedule.due_date.strftime('%m/%d(%a)') }}
                            </div>
                        </div>

                    </div>
                    {% endfor %}
                {% else %}
                    <div class="empty-state">
                        <p>ğŸ“­ ë“±ë¡ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤</p>
                        <p>ë¬¸ì„œë¥¼ ì—…ë¡œë“œí•˜ê±°ë‚˜ ìƒˆ ì¼ì •ì„ ì¶”ê°€í•´ë³´ì„¸ìš”!</p>
                    </div>
                {% endif %}
            </div>
            <button class="btn btn-primary btn-full" onclick="openNewScheduleModal()">
                â• ìƒˆ ì¼ì • ì¶”ê°€
            </button>
        </div>
    </div>
    
    <!-- í•˜ë‹¨ ì˜ì—­: ë¶€ê°€ê¸°ëŠ¥ + ì¼ì • ìƒì„¸ -->
    <div class="dashboard-bottom">
        <!-- ì™¼ìª½: ë¶€ê°€ê¸°ëŠ¥ -->
        <div class="features-section">
            <div class="section-header">
                <h2>ğŸ› ï¸ ë¶€ê°€ê¸°ëŠ¥</h2>
            </div>
            <div class="feature-grid">
                <!-- ë¬¸ì„œ ì—…ë¡œë“œ -->
                <div class="feature-card" onclick="openUploadModal()">
                    <div class="feature-icon">ğŸ“„</div>
                    <div class="feature-name">ë¬¸ì„œ ì—…ë¡œë“œ</div>
                    <div class="feature-desc">(AI ë¶„ì„)</div>
                </div>
                
                <!-- íŒ€ì› ì¼ì • -->
                <div class="feature-card" onclick="openTeamScheduleModal()">
                    <div class="feature-icon">ğŸ‘¥</div>
                    <div class="feature-name">íŒ€ì› ì¼ì •</div>
                    <div class="feature-desc"></div>
                </div>
                
                <!-- ì¼ì • ê²€ìƒ‰ -->
                <div class="feature-card" onclick="openSearchModal()">
                    <div class="feature-icon">ğŸ”</div>
                    <div class="feature-name">ì¼ì • ê²€ìƒ‰</div>
                    <div class="feature-desc"></div>
                </div>
                
                <!-- í†µê³„ í˜„í™© -->
                <div class="feature-card" onclick="openStatsModal()">
                    <div class="feature-icon">ğŸ“Š</div>
                    <div class="feature-name">í†µê³„ í˜„í™©</div>
                    <div class="feature-desc"></div>
                </div>
                
                <!-- ì•Œë¦¼ ì„¤ì • -->
                <div class="feature-card" onclick="openNotificationSettings()">
                    <div class="feature-icon">ğŸ””</div>
                    <div class="feature-name">ì•Œë¦¼ ì„¤ì •</div>
                    <div class="feature-desc"></div>
                </div>
                
                <!-- íŒŒì¼ ë³´ê´€í•¨ -->
                <div class="feature-card" onclick="openFileArchive()">
                    <div class="feature-icon">ğŸ“</div>
                    <div class="feature-name">íŒŒì¼ ë³´ê´€í•¨</div>
                    <div class="feature-desc"></div>
                </div>
            </div>
        </div>
        
        <!-- ì˜¤ë¥¸ìª½: ì¼ì • ìƒì„¸/ìˆ˜ì • -->
        <div class="detail-section">
            <div class="section-header">
                <h2>ğŸ“ ì¼ì • ìƒì„¸</h2>
            </div>
            <div class="detail-content" id="schedule-detail">
                <div class="empty-state">
                    <p>ğŸ‘† ì¼ì •ì„ í´ë¦­í•˜ë©´ ìƒì„¸ ì •ë³´ê°€ í‘œì‹œë©ë‹ˆë‹¤</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ìƒˆ ì¼ì • ì¶”ê°€ ëª¨ë‹¬ -->
<div class="modal" id="new-schedule-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>â• ìƒˆ ì¼ì • ì¶”ê°€</h3>
            <button class="modal-close" onclick="closeModal('new-schedule-modal')">Ã—</button>
        </div>
        <form id="new-schedule-form" method="POST" action="{{ url_for('add_schedule') }}">
            <div class="form-group">
                <label for="new-title">ì œëª© *</label>
                <input type="text" id="new-title" name="title" required placeholder="ì¼ì • ì œëª©">
            </div>
            <div class="form-group">
                <label for="new-task">í•  ì¼ ë‚´ìš© *</label>
                <textarea id="new-task" name="task_description" required placeholder="í•´ì•¼ í•  ì¼ì„ ìƒì„¸íˆ ì…ë ¥í•˜ì„¸ìš”"></textarea>
            </div>
            
            <!-- ì¢…ì¼ ì—¬ë¶€ -->
            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" id="new-all-day" name="is_all_day" checked onchange="toggleTimeFields('new')">
                    ì¢…ì¼ ì¼ì •
                </label>
            </div>
            
            <!-- ë‚ ì§œ -->
            <div class="form-row">
                <div class="form-group">
                    <label for="new-start-date">ì‹œì‘ì¼ *</label>
                    <input type="date" id="new-start-date" name="start_date" required>
                </div>
                <div class="form-group">
                    <label for="new-due-date">ì¢…ë£Œì¼ *</label>
                    <input type="date" id="new-due-date" name="due_date" required>
                </div>
            </div>
            
            <!-- ì‹œê°„ (ì¢…ì¼ì´ ì•„ë‹ ë•Œë§Œ í‘œì‹œ) -->
            <div class="form-row time-fields" id="new-time-fields" style="display: none;">
                <div class="form-group">
                    <label for="new-start-time">ì‹œì‘ ì‹œê°„</label>
                    <input type="time" id="new-start-time" name="start_time">
                </div>
                <div class="form-group">
                    <label for="new-end-time">ì¢…ë£Œ ì‹œê°„</label>
                    <input type="time" id="new-end-time" name="end_time">
                </div>
            </div>
            
            <div class="form-group">
                <label for="new-type">ì¼ì • ìœ í˜•</label>
                <select id="new-type" name="schedule_type">
                    <option value="other">ê¸°íƒ€</option>
                    <option value="deadline">ë§ˆê°</option>
                    <option value="submit">ì œì¶œ</option>
                    <option value="trip">ì¶œì¥</option>
                    <option value="meeting">íšŒì˜</option>
                </select>
            </div>
            <div class="form-group">
                <label for="new-tags">íƒœê·¸ (ì‰¼í‘œë¡œ êµ¬ë¶„)</label>
                <input type="text" id="new-tags" name="tags" placeholder="#ì—…ë¬´, #ì¤‘ìš”">
            </div>
            <div class="form-group">
                <label for="new-memo">ë©”ëª¨</label>
                <textarea id="new-memo" name="memo" placeholder="ì¶”ê°€ ë©”ëª¨"></textarea>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('new-schedule-modal')">ì·¨ì†Œ</button>
                <button type="submit" class="btn btn-primary">ì €ì¥</button>
            </div>
        </form>
    </div>
</div>

<!-- ë¬¸ì„œ ì—…ë¡œë“œ ëª¨ë‹¬ -->
<div class="modal" id="upload-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>ğŸ“„ ë¬¸ì„œ ì—…ë¡œë“œ (AI ì¼ì • ì¶”ì¶œ)</h3>
            <button class="modal-close" onclick="closeModal('upload-modal')">Ã—</button>
        </div>
        <form id="upload-form" method="POST" action="{{ url_for('upload_document') }}" enctype="multipart/form-data">
            <div class="form-group">
                <label for="document">íŒŒì¼ ì„ íƒ</label>
                <input type="file" id="document" name="document" accept=".hwp,.hwpx,.docx,.doc,.pdf" required>
                <p class="form-hint">ì§€ì› í˜•ì‹: HWP, HWPX, DOCX, DOC, PDF (ìµœëŒ€ 16MB)</p>
            </div>
            <div class="upload-preview" id="upload-preview">
                <p>íŒŒì¼ì„ ì„ íƒí•˜ë©´ AIê°€ ìë™ìœ¼ë¡œ ì¼ì •ì„ ì¶”ì¶œí•©ë‹ˆë‹¤.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('upload-modal')">ì·¨ì†Œ</button>
                <button type="submit" class="btn btn-primary">ì—…ë¡œë“œ ë° ë¶„ì„</button>
            </div>
        </form>
    </div>
</div>

<!-- ì¼ì • ìˆ˜ì • ëª¨ë‹¬ -->
<div class="modal" id="edit-schedule-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>âœï¸ ì¼ì • ìˆ˜ì •</h3>
            <button class="modal-close" onclick="closeModal('edit-schedule-modal')">Ã—</button>
        </div>
        <form id="edit-schedule-form" method="POST">
            <input type="hidden" id="edit-id" name="id">
            <div class="form-group">
                <label for="edit-title">ì œëª© *</label>
                <input type="text" id="edit-title" name="title" required>
            </div>
            <div class="form-group">
                <label for="edit-task">í•  ì¼ ë‚´ìš© *</label>
                <textarea id="edit-task" name="task_description" required></textarea>
            </div>
            
            <!-- ì¢…ì¼ ì—¬ë¶€ -->
            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" id="edit-all-day" name="is_all_day" onchange="toggleTimeFields('edit')">
                    ì¢…ì¼ ì¼ì •
                </label>
            </div>
            
            <!-- ë‚ ì§œ -->
            <div class="form-row">
                <div class="form-group">
                    <label for="edit-start-date">ì‹œì‘ì¼ *</label>
                    <input type="date" id="edit-start-date" name="start_date" required>
                </div>
                <div class="form-group">
                    <label for="edit-due-date">ì¢…ë£Œì¼ *</label>
                    <input type="date" id="edit-due-date" name="due_date" required>
                </div>
            </div>
            
            <!-- ì‹œê°„ -->
            <div class="form-row time-fields" id="edit-time-fields" style="display: none;">
                <div class="form-group">
                    <label for="edit-start-time">ì‹œì‘ ì‹œê°„</label>
                    <input type="time" id="edit-start-time" name="start_time">
                </div>
                <div class="form-group">
                    <label for="edit-end-time">ì¢…ë£Œ ì‹œê°„</label>
                    <input type="time" id="edit-end-time" name="end_time">
                </div>
            </div>
            
            <div class="form-group">
                <label for="edit-type">ì¼ì • ìœ í˜•</label>
                <select id="edit-type" name="schedule_type">
                    <option value="other">ê¸°íƒ€</option>
                    <option value="deadline">ë§ˆê°</option>
                    <option value="submit">ì œì¶œ</option>
                    <option value="trip">ì¶œì¥</option>
                    <option value="meeting">íšŒì˜</option>
                </select>
            </div>
            <div class="form-group">
                <label for="edit-tags">íƒœê·¸</label>
                <input type="text" id="edit-tags" name="tags">
            </div>
            <div class="form-group">
                <label for="edit-memo">ë©”ëª¨</label>
                <textarea id="edit-memo" name="memo"></textarea>
            </div>
            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" id="edit-completed" name="is_completed">
                    ì™„ë£Œë¨
                </label>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" onclick="deleteSchedule()">ì‚­ì œ</button>
                <button type="button" class="btn btn-secondary" onclick="closeModal('edit-schedule-modal')">ì·¨ì†Œ</button>
                <button type="submit" class="btn btn-primary">ì €ì¥</button>
            </div>
        </form>
    </div>
</div>

<!-- íŒ€ì› ì¼ì • ëª¨ë‹¬ -->
<div class="modal" id="team-schedule-modal">
    <div class="modal-content modal-large">
        <div class="modal-header">
            <h3>ğŸ‘¥ íŒ€ì› ì¼ì •</h3>
            <button class="modal-close" onclick="closeModal('team-schedule-modal')">Ã—</button>
        </div>
        <div class="team-schedule-content" id="team-schedule-content">
            <p>íŒ€ì›ë“¤ì˜ ì¼ì •ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        </div>
    </div>
</div>

<!-- ê²€ìƒ‰ ëª¨ë‹¬ -->
<div class="modal" id="search-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>ğŸ” ì¼ì • ê²€ìƒ‰</h3>
            <button class="modal-close" onclick="closeModal('search-modal')">Ã—</button>
        </div>
        <div class="form-group">
            <input type="text" id="search-input" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥..." onkeyup="searchSchedules()">
        </div>
        <div class="search-results" id="search-results">
            <p>ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”</p>
        </div>
    </div>
</div>

<!-- í†µê³„ ëª¨ë‹¬ -->
<div class="modal" id="stats-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>ğŸ“Š í†µê³„ í˜„í™©</h3>
            <button class="modal-close" onclick="closeModal('stats-modal')">Ã—</button>
        </div>
        <div class="stats-content" id="stats-content">
            <div class="stat-item">
                <span class="stat-label">ì „ì²´ ì¼ì •</span>
                <span class="stat-value">{{ stats.total }}</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">ì™„ë£Œ</span>
                <span class="stat-value text-success">{{ stats.completed }}</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">ì§„í–‰ ì¤‘</span>
                <span class="stat-value text-primary">{{ stats.pending }}</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">ì§€ì—°</span>
                <span class="stat-value text-danger">{{ stats.overdue }}</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">ì™„ë£Œìœ¨</span>
                <span class="stat-value">{{ stats.completion_rate }}%</span>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // ìº˜ë¦°ë” ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar');
        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            locale: 'ko',
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth,timeGridWeek'
            },
            events: '/api/schedules',
            dateClick: function(info) {
                // ë‚ ì§œ í´ë¦­ ì‹œ ìƒˆ ì¼ì • ì¶”ê°€
                document.getElementById('new-due-date').value = info.dateStr;
                openNewScheduleModal();
            },
            eventClick: function(info) {
                // ì¼ì • í´ë¦­ ì‹œ ìƒì„¸ ë³´ê¸°
                viewSchedule(info.event.id);
            },
            eventDidMount: function(info) {
                // ì™„ë£Œëœ ì¼ì • ìŠ¤íƒ€ì¼
                if (info.event.extendedProps.is_completed) {
                    info.el.style.opacity = '0.6';
                    info.el.style.textDecoration = 'line-through';
                }
            }
        });
        calendar.render();
        
        // ì „ì—­ ë³€ìˆ˜ë¡œ ì €ì¥
        window.calendar = calendar;
    });
    
    // ì¼ì • ìƒì„¸ ë³´ê¸°
    function viewSchedule(id) {
        fetch('/api/schedule/' + id)
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const schedule = data.schedule;
                    const detailHtml = `
                        <div class="detail-card">
                            <h3>${schedule.title}</h3>
                            <div class="detail-row">
                                <span class="detail-label">ğŸ“… ë§ˆê°ì¼</span>
                                <span class="detail-value">${schedule.due_date}</span>
                            </div>
                            ${schedule.end_date ? `
                            <div class="detail-row">
                                <span class="detail-label">ğŸ“… ì¢…ë£Œì¼</span>
                                <span class="detail-value">${schedule.end_date}</span>
                            </div>
                            ` : ''}
                            <div class="detail-row">
                                <span class="detail-label">ğŸ“ ì›ë³¸</span>
                                <span class="detail-value">${schedule.document_filename || 'ì§ì ‘ ì…ë ¥'}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">ğŸ·ï¸ ìœ í˜•</span>
                                <span class="detail-value">${getTypeLabel(schedule.schedule_type)}</span>
                            </div>
                            ${schedule.tags ? `
                            <div class="detail-row">
                                <span class="detail-label">ğŸ·ï¸ íƒœê·¸</span>
                                <span class="detail-value">${schedule.tags}</span>
                            </div>
                            ` : ''}
                            <div class="detail-row">
                                <span class="detail-label">âœ… í•  ì¼</span>
                                <span class="detail-value">${schedule.task_description}</span>
                            </div>
                            ${schedule.memo ? `
                            <div class="detail-row">
                                <span class="detail-label">ğŸ“ ë©”ëª¨</span>
                                <span class="detail-value">${schedule.memo}</span>
                            </div>
                            ` : ''}
                            <div class="detail-actions">
                                <button class="btn btn-secondary" onclick="openEditModal(${schedule.id})">ìˆ˜ì •</button>
                                <button class="btn btn-danger" onclick="confirmDelete(${schedule.id})">ì‚­ì œ</button>
                                ${!schedule.is_completed ? 
                                    `<button class="btn btn-success" onclick="completeSchedule(${schedule.id})">ì™„ë£Œâœ“</button>` 
                                    : ''
                                }
                            </div>
                        </div>
                    `;
                    document.getElementById('schedule-detail').innerHTML = detailHtml;
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
    }
    
    // ì¼ì • ìœ í˜• ë¼ë²¨
    function getTypeLabel(type) {
        const labels = {
            'deadline': 'ë§ˆê°',
            'submit': 'ì œì¶œ',
            'trip': 'ì¶œì¥',
            'meeting': 'íšŒì˜',
            'other': 'ê¸°íƒ€'
        };
        return labels[type] || 'ê¸°íƒ€';
    }
    
    // ìƒˆ ì¼ì • ëª¨ë‹¬ ì—´ê¸°
    function openNewScheduleModal() {
        document.getElementById('new-schedule-modal').classList.add('active');
        // ì˜¤ëŠ˜ ë‚ ì§œë¥¼ ê¸°ë³¸ê°’ìœ¼ë¡œ
        if (!document.getElementById('new-due-date').value) {
            document.getElementById('new-due-date').value = new Date().toISOString().split('T')[0];
        }
    }
    
    // ë¬¸ì„œ ì—…ë¡œë“œ ëª¨ë‹¬ ì—´ê¸°
    function openUploadModal() {
        document.getElementById('upload-modal').classList.add('active');
    }
    
    // ìˆ˜ì • ëª¨ë‹¬ ì—´ê¸°
    function openEditModal(id) {
        fetch('/api/schedule/' + id)
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const schedule = data.schedule;
                    document.getElementById('edit-id').value = schedule.id;
                    document.getElementById('edit-title').value = schedule.title;
                    document.getElementById('edit-task').value = schedule.task_description;
                    document.getElementById('edit-due-date').value = schedule.due_date;
                    document.getElementById('edit-end-date').value = schedule.end_date || '';
                    document.getElementById('edit-type').value = schedule.schedule_type;
                    document.getElementById('edit-tags').value = schedule.tags || '';
                    document.getElementById('edit-memo').value = schedule.memo || '';
                    document.getElementById('edit-completed').checked = schedule.is_completed;
                    document.getElementById('edit-schedule-form').action = '/schedule/' + schedule.id + '/update';
                    document.getElementById('edit-schedule-modal').classList.add('active');
                }
            });
    }
    
    // íŒ€ì› ì¼ì • ëª¨ë‹¬
    function openTeamScheduleModal() {
        document.getElementById('team-schedule-modal').classList.add('active');
        fetch('/api/team-schedules')
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    let html = '';
                    for (const [username, schedules] of Object.entries(data.team_schedules)) {
                        html += `<div class="team-member">
                            <h4>ğŸ‘¤ ${username}</h4>
                            <ul>`;
                        schedules.forEach(s => {
                            html += `<li>${s.due_date}: ${s.title}</li>`;
                        });
                        html += `</ul></div>`;
                    }
                    document.getElementById('team-schedule-content').innerHTML = html || '<p>íŒ€ì› ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                }
            });
    }
    
    // ê²€ìƒ‰ ëª¨ë‹¬
    function openSearchModal() {
        document.getElementById('search-modal').classList.add('active');
        document.getElementById('search-input').focus();
    }
    
    // í†µê³„ ëª¨ë‹¬
    function openStatsModal() {
        document.getElementById('stats-modal').classList.add('active');
    }
    
    // ì•Œë¦¼ ì„¤ì •
    function openNotificationSettings() {
        alert('ì•Œë¦¼ ì„¤ì • ê¸°ëŠ¥ì€ ì¶”í›„ ì—…ë°ì´íŠ¸ ì˜ˆì •ì…ë‹ˆë‹¤.');
    }
    
    // íŒŒì¼ ë³´ê´€í•¨
    function openFileArchive() {
        window.location.href = '/files';
    }
    
    // ëª¨ë‹¬ ë‹«ê¸°
    function closeModal(modalId) {
        document.getElementById(modalId).classList.remove('active');
    }
    
    // ì¼ì • ì‚­ì œ í™•ì¸
    function confirmDelete(id) {
        if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            fetch('/schedule/' + id + '/delete', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        location.reload();
                    } else {
                        alert(data.message);
                    }
                });
        }
    }
    
    // ì¼ì • ì™„ë£Œ
    function completeSchedule(id) {
        fetch('/schedule/' + id + '/complete', { method: 'POST' })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    location.reload();
                } else {
                    alert(data.message);
                }
            });
    }
    
    // ì¼ì • ê²€ìƒ‰
    function searchSchedules() {
        const query = document.getElementById('search-input').value;
        if (query.length < 2) {
            document.getElementById('search-results').innerHTML = '<p>2ì ì´ìƒ ì…ë ¥í•˜ì„¸ìš”</p>';
            return;
        }
        
        fetch('/api/search?q=' + encodeURIComponent(query))
            .then(response => response.json())
            .then(data => {
                if (data.success && data.schedules.length > 0) {
                    let html = '<ul class="search-list">';
                    data.schedules.forEach(s => {
                        html += `<li onclick="viewSchedule(${s.id}); closeModal('search-modal');">
                            <strong>${s.title}</strong><br>
                            <small>${s.due_date}</small>
                        </li>`;
                    });
                    html += '</ul>';
                    document.getElementById('search-results').innerHTML = html;
                } else {
                    document.getElementById('search-results').innerHTML = '<p>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                }
            });
    }
    
    // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
    document.addEventListener('click', function(e) {
        if (e.target.classList.contains('modal')) {
            e.target.classList.remove('active');
        }
    });
    
    // ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸°
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            document.querySelectorAll('.modal.active').forEach(modal => {
                modal.classList.remove('active');
            });
        }
    });
</script>
{% endblock %}
