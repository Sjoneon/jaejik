<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Groq Chatbot</title>
    <style>
      :root {
        --bg: #050816;
        --bg-elevated: #070b1e;
        --accent: #3b82f6;
        --accent-soft: rgba(59, 130, 246, 0.1);
        --accent-strong: rgba(59, 130, 246, 0.25);
        --border-subtle: rgba(148, 163, 184, 0.35);
        --text-main: #e5e7eb;
        --text-muted: #9ca3af;
        --user-bubble: #0f172a;
        --bot-bubble: #020617;
        --danger: #ef4444;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        background: radial-gradient(circle at top, #0b1120 0, #020617 45%, #000 100%);
        color: var(--text-main);
        display: flex;
        align-items: stretch;
        justify-content: center;
      }

      .shell {
        width: 100%;
        max-width: 1100px;
        margin: 16px;
        border-radius: 24px;
        border: 1px solid rgba(148, 163, 184, 0.35);
        background: radial-gradient(circle at top left, rgba(56, 189, 248, 0.05), transparent 60%),
          radial-gradient(circle at top right, rgba(59, 130, 246, 0.08), transparent 55%),
          rgba(15, 23, 42, 0.96);
        backdrop-filter: blur(24px);
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }

      .header {
        padding: 16px 20px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        border-bottom: 1px solid rgba(148, 163, 184, 0.3);
        background: linear-gradient(to right, rgba(15, 23, 42, 0.95), rgba(15, 23, 42, 0.85));
      }

      .brand {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .logo {
        width: 32px;
        height: 32px;
        border-radius: 14px;
        background: radial-gradient(circle at 30% 0, #38bdf8, transparent 55%),
          radial-gradient(circle at 70% 100%, #4f46e5, transparent 55%),
          #020617;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 700;
        font-size: 18px;
        box-shadow: 0 0 0 1px rgba(148, 163, 184, 0.3);
      }

      .title {
        display: flex;
        flex-direction: column;
      }

      .title-main {
        font-weight: 600;
        letter-spacing: 0.02em;
        font-size: 15px;
      }

      .title-sub {
        font-size: 12px;
        color: var(--text-muted);
      }

      .status-pill {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 4px 10px;
        border-radius: 999px;
        background: rgba(22, 163, 74, 0.1);
        color: #bbf7d0;
        font-size: 11px;
        border: 1px solid rgba(34, 197, 94, 0.35);
      }

      .status-dot {
        width: 7px;
        height: 7px;
        border-radius: 999px;
        background: #22c55e;
        box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.35);
      }

      .body {
        flex: 1;
        display: flex;
        flex-direction: column;
        padding: 10px 16px 14px;
        gap: 10px;
      }

      .chat-container {
        flex: 1;
        border-radius: 18px;
        border: 1px solid rgba(148, 163, 184, 0.3);
        background: radial-gradient(circle at top, rgba(15, 23, 42, 1), rgba(15, 23, 42, 0.96));
        padding: 14px 14px 12px;
        display: flex;
        flex-direction: column;
        gap: 10px;
        overflow: hidden;
      }

      .chat-scroll {
        flex: 1;
        overflow-y: auto;
        padding-right: 4px;
        scrollbar-width: thin;
      }

      .chat-scroll::-webkit-scrollbar {
        width: 6px;
      }
      .chat-scroll::-webkit-scrollbar-track {
        background: transparent;
      }
      .chat-scroll::-webkit-scrollbar-thumb {
        background: rgba(148, 163, 184, 0.55);
        border-radius: 999px;
      }

      .message-row {
        display: flex;
        margin-bottom: 10px;
      }

      .message-row.user {
        justify-content: flex-end;
      }

      .message-row.bot {
        justify-content: flex-start;
      }

      .avatar {
        width: 26px;
        height: 26px;
        border-radius: 999px;
        background: radial-gradient(circle at 30% 0, #60a5fa, transparent 55%),
          radial-gradient(circle at 70% 100%, #a855f7, transparent 55%),
          #020617;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 13px;
        margin-right: 8px;
        flex-shrink: 0;
      }

      .avatar.user {
        background: radial-gradient(circle at 30% 0, #22c55e, transparent 55%),
          radial-gradient(circle at 70% 100%, #0ea5e9, transparent 55%),
          #020617;
        margin-right: 0;
        margin-left: 8px;
      }

      .bubble {
        max-width: min(75%, 640px);
        padding: 9px 11px;
        border-radius: 14px;
        font-size: 14px;
        line-height: 1.45;
        border: 1px solid rgba(148, 163, 184, 0.35);
        box-shadow: 0 10px 30px rgba(15, 23, 42, 0.6);
        white-space: pre-wrap;
        word-wrap: break-word;
      }

      .message-row.user .bubble {
        background: radial-gradient(circle at top left, rgba(59, 130, 246, 0.3), transparent 70%),
          var(--user-bubble);
        border-color: rgba(59, 130, 246, 0.7);
      }

      .message-row.bot .bubble {
        background: radial-gradient(circle at top left, rgba(148, 163, 184, 0.35), transparent 65%),
          var(--bot-bubble);
      }

      .suggestions {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-bottom: 4px;
      }

      .chip {
        border-radius: 999px;
        padding: 6px 10px;
        font-size: 12px;
        border: 1px solid rgba(148, 163, 184, 0.45);
        background: rgba(15, 23, 42, 0.95);
        color: var(--text-muted);
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        transition: all 0.16s ease-out;
      }

      .chip-dot {
        width: 6px;
        height: 6px;
        border-radius: 999px;
        background: rgba(59, 130, 246, 0.8);
      }

      .chip:hover {
        border-color: rgba(59, 130, 246, 0.9);
        color: #e5e7eb;
        background: rgba(15, 23, 42, 1);
      }

      .input-area {
        margin-top: auto;
        border-radius: 18px;
        border: 1px solid rgba(148, 163, 184, 0.45);
        background: radial-gradient(circle at top left, rgba(59, 130, 246, 0.18), transparent 70%),
          rgba(15, 23, 42, 0.9);
        padding: 8px 10px 8px 12px;
        display: flex;
        align-items: flex-end;
        gap: 8px;
      }

      .input-inner {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      .input-row {
        display: flex;
        align-items: flex-end;
        gap: 8px;
      }

      textarea {
        flex: 1;
        resize: none;
        border: none;
        outline: none;
        background: transparent;
        color: var(--text-main);
        font-size: 14px;
        max-height: 120px;
      }

      textarea::placeholder {
        color: rgba(148, 163, 184, 0.9);
      }

      .send-btn {
        border-radius: 999px;
        padding: 9px 14px;
        border: none;
        background: linear-gradient(135deg, #3b82f6, #6366f1);
        color: white;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 4px;
        font-size: 13px;
        font-weight: 500;
        cursor: pointer;
        box-shadow: 0 10px 25px rgba(59, 130, 246, 0.55);
        transition: transform 0.1s ease-out, box-shadow 0.1s ease-out, filter 0.1s ease-out;
        flex-shrink: 0;
      }

      .send-btn span.icon {
        font-size: 14px;
      }

      .send-btn:disabled {
        opacity: 0.6;
        cursor: default;
        box-shadow: none;
      }

      .send-btn:not(:disabled):active {
        transform: translateY(1px) scale(0.99);
        box-shadow: 0 6px 16px rgba(59, 130, 246, 0.55);
      }

      .meta-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 11px;
        color: var(--text-muted);
      }

      .error {
        color: #fecaca;
        display: none;
      }

      .error.visible {
        display: inline;
      }

      .footer {
        padding: 6px 18px 12px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 11px;
        color: var(--text-muted);
        border-top: 1px solid rgba(148, 163, 184, 0.35);
        background: radial-gradient(circle at bottom, rgba(15, 23, 42, 1), rgba(15, 23, 42, 0.96));
      }

      @media (max-width: 768px) {
        .shell {
          margin: 8px;
          border-radius: 18px;
        }

        .header {
          padding: 10px 14px;
        }

        .body {
          padding: 8px 10px 10px;
        }

        .chat-container {
          padding: 10px 10px 8px;
        }

        .input-area {
          padding: 7px 8px;
        }

        .send-btn {
          padding-inline: 11px;
        }
      }
    </style>
  </head>
  <body>
    <div class="shell">
      <header class="header">
        <div class="brand">
          <div class="logo">G</div>
          <div class="title">
            <span class="title-main">Groq Chatbot</span>
            <span class="title-sub">Qwen3-32B powered assistant</span>
          </div>
        </div>
        <div class="status-pill">
          <span class="status-dot"></span>
          <span id="status-text">Ready</span>
        </div>
      </header>

      <main class="body">
        <section class="chat-container">
          <div class="chat-scroll" id="chat"></div>

          <div class="suggestions" id="suggestions">
            <button class="chip" data-prompt="Groq와 Qwen3-32B 모델에 대해 간단히 설명해줘.">
              <span class="chip-dot"></span>
              <span>Groq + Qwen3-32B가 뭐야?</span>
            </button>
            <button class="chip" data-prompt="파이썬으로 간단한 Flask API 예제를 만들어줘.">
              <span class="chip-dot"></span>
              <span>Flask API 예제 만들기</span>
            </button>
            <button class="chip" data-prompt="LLM 응답 품질을 높이기 위한 프롬프트 팁을 알려줘.">
              <span class="chip-dot"></span>
              <span>프롬프트 작성 팁</span>
            </button>
          </div>

          <div class="input-area">
            <div class="input-inner">
              <div class="input-row">
                <textarea
                  id="input"
                  rows="1"
                  placeholder="질문을 입력하고 Enter 를 눌러보세요. Shift+Enter 로 줄바꿈."
                ></textarea>
                <button id="send" class="send-btn">
                  <span class="icon">➤</span>
                  <span>보내기</span>
                </button>
              </div>
              <div class="meta-row">
                <span>Qwen3-32B · Groq API</span>
                <span id="error" class="error"></span>
              </div>
            </div>
          </div>
        </section>
      </main>

      <footer class="footer">
        <span>환경 변수 <code>GROQ_API_KEY</code> 가 설정되어 있어야 합니다.</span>
        <span>샘플 UI · 로컬에서만 사용하세요.</span>
      </footer>
    </div>

    <script>
      const chat = document.getElementById("chat");
      const input = document.getElementById("input");
      const sendBtn = document.getElementById("send");
      const errorEl = document.getElementById("error");
      const statusText = document.getElementById("status-text");
      const suggestions = document.getElementById("suggestions");

      function appendMessage(role, content) {
        const row = document.createElement("div");
        row.className = `message-row ${role}`;

        const avatar = document.createElement("div");
        avatar.className = `avatar ${role}`;
        avatar.textContent = role === "user" ? "U" : "G";

        const bubble = document.createElement("div");
        bubble.className = "bubble";
        bubble.textContent = content;

        if (role === "user") {
          row.appendChild(bubble);
          row.appendChild(avatar);
        } else {
          row.appendChild(avatar);
          row.appendChild(bubble);
        }

        chat.appendChild(row);
        chat.scrollTop = chat.scrollHeight;
      }

      function setLoading(isLoading) {
        if (isLoading) {
          sendBtn.disabled = true;
          statusText.textContent = "Thinking...";
        } else {
          sendBtn.disabled = false;
          statusText.textContent = "Ready";
        }
      }

      async function sendMessage() {
        const message = input.value.trim();
        if (!message) return;

        errorEl.textContent = "";
        errorEl.classList.remove("visible");

        appendMessage("user", message);
        input.value = "";
        resizeTextarea();

        setLoading(true);
        let thinkingRow = document.createElement("div");
        thinkingRow.className = "message-row bot";
        thinkingRow.innerHTML =
          '<div class="avatar">G</div><div class="bubble">생각 중...</div>';
        chat.appendChild(thinkingRow);
        chat.scrollTop = chat.scrollHeight;

        try {
          const res = await fetch("/chat", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ message }),
          });

          const data = await res.json().catch(() => ({}));

          chat.removeChild(thinkingRow);

          if (!res.ok) {
            const msg = data.error || `Error ${res.status}`;
            errorEl.textContent = msg;
            errorEl.classList.add("visible");
            appendMessage("bot", "오류가 발생했습니다: " + msg);
          } else {
            appendMessage("bot", data.reply || "(응답이 비어 있습니다)");
          }
        } catch (e) {
          chat.removeChild(thinkingRow);
          const msg = e.message || String(e);
          errorEl.textContent = msg;
          errorEl.classList.add("visible");
          appendMessage("bot", "요청 중 오류가 발생했습니다: " + msg);
        } finally {
          setLoading(false);
          input.focus();
        }
      }

      function resizeTextarea() {
        input.style.height = "auto";
        input.style.height = input.scrollHeight + "px";
      }

      input.addEventListener("input", resizeTextarea);

      input.addEventListener("keydown", (e) => {
        if (e.key === "Enter" && !e.shiftKey) {
          e.preventDefault();
          sendMessage();
        }
      });

      sendBtn.addEventListener("click", () => {
        sendMessage();
      });

      suggestions.addEventListener("click", (e) => {
        const chip = e.target.closest(".chip");
        if (!chip) return;
        const prompt = chip.getAttribute("data-prompt");
        if (!prompt) return;
        input.value = prompt;
        resizeTextarea();
        input.focus();
      });

      appendMessage(
        "bot",
        "안녕하세요! Groq Qwen3-32B 기반 챗봇입니다.\n왼쪽 아래 예시 질문을 눌러보거나, 직접 질문을 입력해보세요."
      );
    </script>
  </body>
</html>
